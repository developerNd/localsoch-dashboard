<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Vendor Update</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .error {
            color: #ef4444;
            background: #fef2f2;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info {
            color: #3b82f6;
            background: #eff6ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .code {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Vendor Update API</h1>
    
    <div class="debug-section">
        <h2>Current Error</h2>
        <div class="error">
            <strong>Error:</strong> 400: {"data":null,"error":{"status":400,"name":"SyntaxError","message":"invalid JSON, only supports object and array"}}
        </div>
    </div>

    <div class="debug-section">
        <h2>Debug Steps</h2>
        <div class="info">
            <p>To debug this issue, please:</p>
            <ol>
                <li>Open browser developer tools (F12)</li>
                <li>Go to the Network tab</li>
                <li>Try to update shop details</li>
                <li>Look for the PUT request to `/api/vendors/{id}`</li>
                <li>Check the request payload and response</li>
            </ol>
        </div>
    </div>

    <div class="debug-section">
        <h2>Expected Request Format</h2>
        <div class="info">
            <h3>Scenario 1: No Image Upload</h3>
            <div class="code">
Method: PUT
URL: /api/vendors/{id}
Content-Type: application/json
Body: {
  "data": {
    "name": "Shop Name",
    "description": "Shop Description",
    "contact": "1234567890",
    "email": "shop@example.com",
    "address": "Shop Address",
    "city": "City",
    "state": "State",
    "pincode": "123456",
    "gstNumber": "",
    "businessType": ""
  }
}
            </div>
            
            <h3>Scenario 2: With Image Upload</h3>
            <div class="code">
Method: PUT
URL: /api/vendors/{id}
Content-Type: multipart/form-data
Body: FormData with:
- data: "{\"name\":\"Shop Name\",\"description\":\"Shop Description\",...}"
- files.profileImage: [image file]
            </div>
        </div>
    </div>

    <div class="debug-section">
        <h2>Current Code Analysis</h2>
        <div class="info">
            <h3>useUpdateVendor Hook (Fixed)</h3>
            <div class="code">
export function useUpdateVendor() {
  return useMutation({
    mutationFn: async ({ id, data }: { id: number; data: any }) => {
      let requestData: any;
      let headers: any = {};
      
      if (data instanceof FormData) {
        requestData = data;
        // Don't set Content-Type for FormData
      } else {
        // Regular JSON data - wrap in data property for Strapi
        requestData = { data };
        headers = { 'Content-Type': 'application/json' };
      }
      
      const response = await apiRequest('PUT', `/api/vendors/${id}`, requestData, headers);
      return await response.json();
    }
  });
}
            </div>
        </div>
    </div>

    <div class="debug-section">
        <h2>Possible Issues</h2>
        <div class="info">
            <ul>
                <li><strong>Double wrapping:</strong> Data might be wrapped in multiple data properties</li>
                <li><strong>FormData format:</strong> JSON string in FormData might be malformed</li>
                <li><strong>Content-Type:</strong> Wrong Content-Type header being sent</li>
                <li><strong>Data structure:</strong> Unexpected data structure in the request</li>
            </ul>
        </div>
    </div>

    <div class="debug-section">
        <h2>Test API Call</h2>
        <div class="info">
            <p>You can test the API directly using this button:</p>
            <button onclick="testVendorUpdate()">Test Vendor Update API</button>
            <div id="test-result"></div>
        </div>
    </div>

    <script>
        async function testVendorUpdate() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<p>Testing API call...</p>';
            
            try {
                // Get auth token
                const token = localStorage.getItem('authToken');
                if (!token) {
                    resultDiv.innerHTML = '<p style="color: red;">No auth token found. Please login first.</p>';
                    return;
                }
                
                // Test data
                const testData = {
                    name: "Test Shop",
                    description: "Test Description",
                    contact: "1234567890",
                    email: "test@example.com",
                    address: "Test Address",
                    city: "Test City",
                    state: "Test State",
                    pincode: "123456"
                };
                
                // Make API call
                const response = await fetch('http://192.168.1.102:1337/api/vendors/1', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data: testData })
                });
                
                const result = await response.text();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<p style="color: green;">‚úÖ Success! Response: ${result}</p>`;
                } else {
                    resultDiv.innerHTML = `<p style="color: red;">‚ùå Error ${response.status}: ${result}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">‚ùå Network Error: ${error.message}</p>`;
            }
        }
        
        console.log('üîç Debug Vendor Update Page Loaded');
        console.log('‚úÖ Use browser dev tools to inspect network requests');
        console.log('‚úÖ Check the request payload and response for the vendor update API call');
    </script>
</body>
</html> 